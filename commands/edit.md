---
description: Edit an existing image or diagram with AI
argument-hint: <source-image> <edit-instructions>
allowed-tools: [Read, Bash]
---

# Edit Existing Image or Diagram

The user wants to edit an existing image. Parse the arguments to extract:
1. **Source image path** — the first argument (a file path ending in .png, .jpg, .jpeg, .gif, .webp)
2. **Edit instructions** — everything after the source path

Arguments: $ARGUMENTS

## Steps

1. **Verify the source file exists** using the Read tool to confirm the path is valid.

2. **Determine the type** — check if the source was generated by nano-banana:
   - If the filename contains `diagram`, `_v1`, `_v2`, or there's a `*_review_log.json` alongside it → treat as a **diagram edit**
   - Otherwise → treat as an **image edit**

3. **Run the appropriate script:**

   For **image edits**:
   ```bash
   python3 ${CLAUDE_PLUGIN_ROOT}/skills/image/scripts/generate_image.py "<edit-instructions>" --input <source-image> -o <output-path>
   ```

   For **diagram edits**:
   ```bash
   python3 ${CLAUDE_PLUGIN_ROOT}/skills/diagram/scripts/generate_diagram_ai.py "<edit-instructions>" --input <source-image> -o <output-path> --doc-type default
   ```

4. **Output naming** — save the edited version alongside the original:
   - If source is `architecture.png` → output as `architecture_edit1.png`
   - If `architecture_edit1.png` already exists → use `architecture_edit2.png`
   - Increment the edit number to avoid overwriting previous edits

5. **Report the result** — tell the user where the edited image was saved and what was changed.

## Important

- Always verify the source image exists before running any script
- Preserve the original file — never overwrite it
- If the user provides a diagram doc-type, pass it to the diagram script with `--doc-type`
- If arguments are missing or unclear, ask the user for the source path and edit instructions
